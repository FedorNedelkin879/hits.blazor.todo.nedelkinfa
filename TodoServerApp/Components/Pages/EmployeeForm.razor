@page "/employees/add"
@page "/employees/{Id:int}"
@rendermode InteractiveServer
@inject IDataService dataService
@inject NavigationManager navigationManager
@attribute [Authorize]

<PageTitle>@(Id == 0 ? "Новый сотрудник" : "Редактирование сотрудника")</PageTitle>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-6 offset-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h3 class="mb-0">@(Id == 0 ? "Добавить сотрудника" : "Редактировать сотрудника")</h3>
                </div>

                <div class="card-body">
                    @if (employee != null)
                    {
                        <EditForm Model="employee" FormName="EmployeeForm" OnValidSubmit="SaveEmployee">
                            <DataAnnotationsValidator />
                            <ValidationSummary class="alert alert-danger" />

                            <div class="mb-3">
                                <label class="form-label">Имя сотрудника</label>
                                <InputText @bind-Value="employee.Name" class="form-control border-secondary" />
                                <ValidationMessage For="() => employee.Name" />
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Должность</label>
                                <InputSelect @bind-Value="employee.Position" class="form-select border-secondary">
                                    <option value="">Выберите должность</option>
                                    <option value="Кассир">Кассир</option>
                                    <option value="Менеджер">Менеджер</option>
                                    <option value="Кладовщик">Кладовщик</option>
                                    <option value="Администратор">Администратор</option>
                                    <option value="Начальник отдела">Начальник отдела</option>
                                </InputSelect>
                                <ValidationMessage For="() => employee.Position" />
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Отдел</label>
                                <InputSelect @bind-Value="employee.Department" class="form-select border-secondary">
                                    <option value="">Выберите отдел</option>
                                    <option value="Продажи">Продажи</option>
                                    <option value="Управление">Управление</option>
                                    <option value="Склад">Склад</option>
                                    <option value="HR">HR</option>
                                    <option value="IT">IT</option>
                                </InputSelect>
                                <ValidationMessage For="() => employee.Department" />
                            </div>

                            <div class="d-flex gap-2 pt-3">
                                <button type="submit" class="btn btn-primary">Сохранить</button>
                                <a href="employees" class="btn btn-secondary">Отмена</a>
                            </div>
                        </EditForm>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    [SupplyParameterFromForm]
    private Employee? employee { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (employee == null)
        {
            employee = new();
            if (Id != 0)
            {
                var existing = await dataService.GetEmployeeAsync(Id);
                employee.Id = existing.Id;
                employee.Name = existing.Name;
                employee.Position = existing.Position;
                employee.Department = existing.Department;
                employee.HireDate = existing.HireDate;
            }
        }
    }

    private async Task SaveEmployee()
    {
        await dataService.SaveEmployeeAsync(employee!);
        navigationManager.NavigateTo("employees");
    }
}
